@using SRS.Services.Models.Constants
@using SRS.Services.Models.ThemeOfScientificWorkModels

@model SRS.Web.Models.CathedraReports.CathedraReportViewModel

@{
    ViewBag.Title = "Кафедральний звіт";
}

<h2>Кафедральний звіт</h2>

<div id="wizard">
    <h3>Досягнення провідних наукових шкіл</h3>
    <section class="section-body">
        @using (@Html.BeginForm("UpdateAchievementSchoolInfo", "CathedraReport", FormMethod.Post, new { @id = "updateAchievementSchoolForm" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label class="control-label">
                    1. Досягнення провідних наукових шкіл за звітний рік (до 1 с.):
                </label>
                <div>
                    @Html.TextAreaFor(model => model.AchivementSchool, 15, 70, new
                    {
                        @class = "form-control",
                        @style = "max-width: 100%",
                        @Value = Model.AchivementSchool,
                    })
                </div>
            </div>
            <input type="hidden" name="stepIndex" value="@ViewBag.StepIndex" id="stepIndex_1" />
            <input type="hidden" name="Id" value="@Model.Id" />
        }
    </section>
    <h3>Держбюджетні теми</h3>
    <section class="section-body">
        @using (@Html.BeginForm("UpdateBudgetThemeInfo", "CathedraReport", FormMethod.Post, new { @id = "updateBudgetThemeForm" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label class="control-label">
                    2. Держбюджетні теми: <span class="text-danger">*</span>
                </label>
                @foreach (var theme in (IList<CathedraReportThemeOfScientificWorkModel>)ViewBag.BudgetThemes)
                {
                    <div><b>Тема @theme.Code “@theme.Value”</b></div>
                    <div><b>Науковий керівник:</b> @theme.ScientificHead</div>
                    <div>Номер державної реєстрації: @theme.ThemeNumber.</div>
                    {
                        var financial = theme.ThemeOfScientificWorkFinancials.FirstOrDefault(x => x.Year == DateTime.Now.Year);
                        <div>Термін дії теми: @theme.PeriodFrom.ToString(Dates.UaDatePattern)&mdash;@theme.PeriodFrom.ToString(Dates.UaDatePattern) р. Обсяг фінансування: @(financial != null ? financial.Amount : 0m) грн. у @DateTime.Now.Year році.</div>
                    }
                    <div><b>Резюме</b></div>
                    <div>@(theme.ReportThemeOfScientificWork != null ? theme.ReportThemeOfScientificWork.Resume : "")</div>
                    <div><b>Публікації</b></div>
                    <div>@(theme.ReportThemeOfScientificWork != null ? theme.ReportThemeOfScientificWork.Publications : "")</div>
                    <div><b>Захищені дисертації</b></div>
                    <div>@(theme.ReportThemeOfScientificWork != null ? theme.ReportThemeOfScientificWork.DefendedDissertation : "")</div>
                    <hr />
                }
            </div>
            <input type="hidden" name="stepIndex" value="@ViewBag.StepIndex" id="stepIndex_2" />
            <input type="hidden" name="Id" value="@Model.Id" />
        }
    </section>
    <h3>Теми в межах робочого часу</h3>
    <section class="section-body">
        @using (@Html.BeginForm("UpdateInWorkThemeInfo", "CathedraReport", FormMethod.Post, new { @id = "updateInWorkThemeForm" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label class="control-label">
                    3. Теми, які виконуються в межах робочого часу викладачів: <span class="text-danger">*</span>
                </label>
                <div>
                    <div id="scientific-work-search" class="search-container">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon1"><i class="bi bi-search"></i></span>
                            <input class="form-control" placeholder="Пошук за назвою, номером, шифром, науковим керівником" />
                        </div>
                        <div class="search-results">
                        </div>
                    </div>
                    <div class="selected-items selected-scientific-works">
                    </div>
                </div>
            </div>
            <input type="hidden" name="stepIndex" value="@ViewBag.StepIndex" id="stepIndex_3" />
            <input type="hidden" name="Id" value="@Model.Id" />
        }
    </section>

    <h3>Госпдоговірна тематика</h3>
    <section class="section-body">
        @using (@Html.BeginForm("UpdateHospDohovirThemeInfo", "CathedraReport", FormMethod.Post, new { @id = "updateHospDohovirThemeForm" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label class="control-label">
                    4. Госпдоговірна тематика: <span class="text-danger">*</span>
                </label>
                <div>
                    <div id="scientific-work-search" class="search-container">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon1"><i class="bi bi-search"></i></span>
                            <input class="form-control" placeholder="Пошук за назвою, номером, шифром, науковим керівником" />
                        </div>
                        <div class="search-results">
                        </div>
                    </div>
                    <div class="selected-items selected-scientific-works">
                    </div>
                </div>
            </div>
            <input type="hidden" name="stepIndex" value="@ViewBag.StepIndex" id="stepIndex_4" />
            <input type="hidden" name="Id" value="@Model.Id" />
        }
    </section>
    <h3>Інше</h3>
    <section class="section-body">
        @using (@Html.BeginForm("UpdateOtherInfo", "CathedraReport", FormMethod.Post, new { @id = "updateOtherForm" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label class="control-label">
                    5. Інші форми наукової діяльності
                    (робота спеціалізованих вчених, експертних рад, рецензування та опонування дисертацій тощо):
                </label>
                <div>
                    @Html.TextAreaFor(model => model.OtherFormsOfScientificWork, 6, 70, new
                    {
                        @class = "form-control",
                        @style = "max-width: 100%",
                        @Value = Model.OtherFormsOfScientificWork,
                    })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label">
                    6. Зовнішні зв’язки:
                </label>
                <div class="form-group">
                    <label class="control-label">
                        6.1. Співпраця з науковими установами НАН України
                        та галузевих академій наук України
                        (наукові стажування, кількість спільних публікацій, спільні наукові заходи):
                    </label>
                    <div>
                        @Html.TextAreaFor(model => model.CooperationWithAcadamyOfScience, 6, 70, new
                        {
                            @class = "form-control",
                            @style = "max-width: 100%",
                            @Value = Model.CooperationWithAcadamyOfScience,
                        })
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label">
                        6.2. Співпраця із закордонними науковими установами та фірмами
                        (наукові стажування, контракти, кількість
                        спільних публікацій, спільні наукові заходи, запрошення закордонних науковців):
                    </label>
                    <div>
                        @Html.TextAreaFor(model => model.CooperationWithForeignScientificInstitution, 6, 70, new
                        {
                            @class = "form-control",
                            @style = "max-width: 100%",
                            @Value = Model.CooperationWithForeignScientificInstitution,
                        })
                    </div>
                </div>

            </div>

            <div class="form-group">
                <label class="control-label">
                    8. Студентська наукова робота: кількість наукових гуртків і кількість студентів,
                    що беруть участь у їхній роботі; участь (кількість студентів) у виконанні держбюджетної
                    чи іншої наукової тематики; проведені студентські наукові конференції на базі
                    університету; виступи на конференціях (кількість доповідей за участю студентів,
                    назви конференцій); індивідуальні та спільні зі співробітниками університету
                    публікації; отримані нагороди у II етапі Всеукраїнських студентських Олімпіад,
                    міжнародних Олімпіадах, Всеукраїнських конкурсах студентських наукових робіт,
                    турнірах, чемпіонатах тощо:
                </label>
                <div>
                    @Html.TextAreaFor(model => model.StudentsWorks, 6, 70, new
                    {
                        @class = "form-control",
                        @style = "max-width: 100%",
                        @Value = Model.StudentsWorks,
                    })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label">
                    10. Конференції: стислий звіт про проведення конференцій
                    на базі університету (0,5 с. про кожну конференцію):
                </label>
                <div>
                    @Html.TextAreaFor(model => model.ConferencesInUniversity, 6, 70, new
                    {
                        @class = "form-control",
                        @style = "max-width: 100%",
                        @Value = Model.ConferencesInUniversity,
                    })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label">
                    12. Матеріальна база підрозділу (обладнання, придбане за звітний період чи введене в дію на кінець звітного року):
                </label>
                <div>
                    @Html.TextAreaFor(model => model.Materials, 6, 70, new
                    {
                        @class = "form-control",
                        @style = "max-width: 100%",
                        @Value = Model.Materials,
                    })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label">
                    13. Пропозиції щодо нових форм організації наукової роботи в ринкових умовах:
                </label>
                <div>
                    @Html.TextAreaFor(model => model.PropositionForNewForms, 6, 70, new
                    {
                        @class = "form-control",
                        @style = "max-width: 100%",
                        @Value = Model.PropositionForNewForms,
                    })
                </div>
            </div>
            <input type="hidden" name="stepIndex" value="@ViewBag.StepIndex" id="stepIndex_5" />
            <input type="hidden" name="Id" value="@Model.Id" />
        }
    </section>
    <h3>Дата та протокол</h3>
    <section class="section-body">
        @using (@Html.BeginForm("UpdateFinalInfo", "CathedraReport", FormMethod.Post, new { @id = "updateFinishForm" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label class="control-label">
                    Дата:
                </label>
                <div>
                    @Html.EditorFor(model => model.Date, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label">
                    Протокол:
                </label>
                <div>
                    @Html.TextBoxFor(model => model.Protocol, new { @class = "form-control" })
                </div>
            </div>

            @Html.ValidationSummary("", new { @class = "text-danger" })
            <input type="hidden" name="stepIndex" value="@ViewBag.StepIndex" id="stepIndex_6" />
            <input type="hidden" name="Id" value="@Model.Id" />
        }
    </section>
    <h3>Завершення</h3>
    <section class="section-body">
        @using (@Html.BeginForm("Finalize", "CathedraReport", FormMethod.Post, new { @id = "updateEndForm" }))
        {
            @Html.AntiForgeryToken()
            <div style="text-align: center;
                        margin: 20px;
                        font-size: 22px;
                        color: green;">
                Ваш звіт успішно заповнено!
            </div>
            <input type="hidden" name="stepIndex" value="@ViewBag.StepIndex" id="stepIndex_7" />
            <input type="hidden" name="Id" value="@Model.Id" />
        }
        <div style="padding-top: 50px;
                        display: flex;
                        justify-content: space-evenly;">
            @if (Model.Date.HasValue && !string.IsNullOrEmpty(Model.Protocol))
            {
                using (Html.BeginForm("Sign", "CathedraReportList"))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("reportId", Model.Id)
                    <button type="submit" class="btn btn-primary" id="signButton">Підписати</button>
                }
            }
            @Html.ActionLink("Експорт у PDF", "PreviewPdf", "CathedraReportGeneration", new { reportId = Model.Id }, new { @class = "btn btn-default", @target = "_blank" })
            @Html.ActionLink("Експорт у LaTex", "GetLatex", "CathedraReportGeneration", new { reportId = Model.Id }, new { @class = "btn btn-default" })
            @Html.ActionLink("Експорт у Word (тест-версія)", "GetWord", "CathedraReportGeneration", new { reportId = Model.Id }, new { @class = "btn btn-default" })
            <a href="@Url.Action("Preview", "CathedraReportGeneration", new { reportId = Model.Id })"
               target="_blank"
               class="btn btn-default">
                Переглянути
            </a>
        </div>
    </section>
</div>

@section Styles {
    @Styles.Render("~/Content/chosen/bundle")
    @Styles.Render("~/Content/steps/bundle")
    @Styles.Render("~/Content/reports/bundle")
}
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/chosen")
    @Scripts.Render("~/bundles/steps")
    @Scripts.Render("~/bundles/stepper")
    @Scripts.Render("~/bundles/cathedrareports/edit")
}